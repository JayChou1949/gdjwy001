<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.upd.hwcloud.dao.PaasZhzyMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.upd.hwcloud.bean.entity.PaasZhzy">
        <id column="ID" property="id" />
        <result column="TENANT_NAME" property="tenantName" />
        <result column="APPLY_NAME" property="applyName" />
        <result column="AREA" property="area" />
        <result column="POLICE" property="police" />
        <result column="NATIONAL_SPECIAL_PROJECT" property="nationalSpecialProject" />
        <result column="SUPER_CLUSTER_EN" property="superClusterEn" />
        <result column="SUPER_CLUSTER_CN" property="superClusterCn" />
        <result column="TYPE_SITE" property="typeSite" />
        <result column="ODS_TIME" property="odsTime" />
        <result column="CPU_TOTAL" property="cpuTotal" />
        <result column="CPU_USAGE" property="cpuUsage" />
        <result column="CPU_USED" property="cpuUsed" />
        <result column="MEMORY_TOTAL" property="memoryTotal" />
        <result column="MEMORY_USAGE" property="memoryUsage" />
        <result column="MEMORY_USED" property="memoryUsed" />
        <result column="ELASTICSEARCH_STORAGE_SPACE" property="elasticsearchStorageSpace" />
        <result column="ELASTICSEARCH_MONITOR_OBJECT" property="elasticsearchMonitorObject" />
        <result column="ELASTICSEARCH_CPU_TOTAL" property="elasticsearchCpuTotal" />
        <result column="ELASTICSEARCH_CPU_USAGE" property="elasticsearchCpuUsage" />
        <result column="ELASTICSEARCH_MEMORY_TOTAL" property="elasticsearchMemoryTotal" />
        <result column="ELASTICSEARCH_MEMORY_USAGE" property="elasticsearchMemoryUsed" />
        <result column="ELASTICSEARCH_DISK_AVAILABLE" property="elasticsearchDiskAvailable" />
        <result column="ELASTICSEARCH_DISK_USED" property="elasticsearchDiskUsed" />
        <result column="REDIS_CLUSTER_NAME" property="redisClusterName" />
        <result column="REDIS_MEMORY_TOTAL" property="redisMemoryTotal" />
        <result column="REDIS_MEMORY_USAGE" property="redisMemoryUsage" />
        <result column="KAFKA_STORAGE_SPACE_NAME" property="kafkaStorageSpaceName" />
        <result column="elastricsearch_is_share" property="elastricsearchIsShare" />
        <result column="elastricsearch_hosts_number" property="elastricsearchHostsNumber" />
    </resultMap>

<!--    拼接条件语句-->
    <sql id="commom" >
        <if test="area != null and area != ''">
            AND AREA=#{area}
        </if>
        <if test="police != null and police != ''">
            AND POLICE=#{police}
        </if>

        <if test="day==1">
            and TO_CHAR(ODS_TIME,'YYYYMMDD')=TO_CHAR(SYSDATE,'YYYYMMDD')
        </if>

        <if test="day==7">
            and TO_CHAR(ODS_TIME,'YYYYMMDD')=TO_CHAR(SYSDATE,'YYYYMMDD')
        </if>
        <if test="day==30">
            and TO_CHAR(ODS_TIME,'YYYYMMDD')=TO_CHAR(SYSDATE,'YYYYMMDD')
        </if>
    </sql>

    <!--查询Yarn资源-->
    <select id="getPaasYarnResource" resultMap="BaseResultMap">
        SELECT CPU_TOTAL,CPU_USAGE,CPU_USED,MEMORY_TOTAL,MEMORY_USAGE,MEMORY_USED,ODS_TIME FROM TB_PAAS_ZHZY
        WHERE TYPE_SITE='hadoop'  and APPLY_NAME=#{appName}
        <include refid="commom"></include>

    </select>

<!--    查询yarn的cpu 峰值-->
    <select id="maxYarnCpu" resultMap="BaseResultMap">
        SELECT max(CPU_USAGE) FROM TB_PAAS_ZHZY
        WHERE TYPE_SITE='hadoop'  and APPLY_NAME=#{appName}
        <include refid="commom"></include>

    </select>
    <!--    查询yarn的cpu 峰值-->
    <select id="maxYarnCpu" resultMap="BaseResultMap">
        SELECT max(CPU_USAGE) FROM TB_PAAS_ZHZY
        WHERE TYPE_SITE='hadoop'  and APPLY_NAME=#{appName}
        <include refid="commom"></include>
    </select>

    <!--    查询yarn的cpu,内存的总量-->
    <select id="totalYarnCpu" resultMap="BaseResultMap">
        SELECT sum(CPU_TOTAL) ,sum(MEMORY_TOTAL) FROM TB_PAAS_ZHZY
        WHERE TYPE_SITE='hadoop'  and APPLY_NAME=#{appName}
        <include refid="commom"></include>
    </select>

    <!--查询Libra资源-->
    <select id="getPaasLibraResource" resultMap="BaseResultMap">
        SELECT CPU_TOTAL,CPU_USAGE,CPU_USED,MEMORY_TOTAL,MEMORY_USAGE,MEMORY_USED,ODS_TIME,STORAGE_TOTAL FROM TB_PAAS_ZHZY
        WHERE TYPE_SITE='Libra'  and APPLY_NAME=#{appName}
        <include refid="commom"></include>
    </select>



    <!--    查询Libra的cpu 峰值-->
    <select id="maxLibraCpu" resultMap="BaseResultMap">
        SELECT max(CPU_USAGE) FROM TB_PAAS_ZHZY
        WHERE TYPE_SITE='Libra'  and APPLY_NAME=#{appName}
        <include refid="commom"></include>

    </select>

    <!--    查询Libra的 存储 峰值-->
    <select id="maxLibraStorage" resultMap="BaseResultMap">
        SELECT max(STORAGE_USAGE) FROM TB_PAAS_ZHZY
        WHERE TYPE_SITE='Libra'  and APPLY_NAME=#{appName}
        <include refid="commom"></include>
    </select>

    <!--    查询Libra的 内存峰值-->
    <select id="maxLibraMemary" resultMap="BaseResultMap">
        SELECT max(MEMORY_USAGE) FROM TB_PAAS_ZHZY
        WHERE TYPE_SITE='Libra'  and APPLY_NAME=#{appName}
        <include refid="commom"></include>
    </select>

    <!--    查询Libra的 内存,cpu,存储总数-->
    <select id="totalLibraMemary" resultMap="BaseResultMap">
        SELECT sum(MEMORY_TOTAL) ,sum(CPU_TOTAL) ,sum(STORAGE_TOTAL)  FROM TB_PAAS_ZHZY
        WHERE TYPE_SITE='Libra'  and APPLY_NAME=#{appName}
        <include refid="commom"></include>
    </select>


<!--    es内存，cpu存储使用情况-->

    <select id="getPaasEsResource" resultMap="BaseResultMap">
        SELECT ELASTICSEARCH_CPU_TOTAL,ELASTICSEARCH_CPU_USAGE,ELASTICSEARCH_MEMORY_TOTAL,ELASTICSEARCH_MEMORY_USED,ODS_TIME,
        SUPER_CLUSTER_CN,SUPER_CLUSTER_EN,ELASTICSEARCH_HOSTS_NUMBER
         FROM TB_PAAS_ZHZY
        WHERE APPLY_NAME=#{appName}
        <include refid="commom"></include>

    </select>

<!--    es存储峰值-->
    <select id="maxEsStorage" resultMap="BaseResultMap">
        SELECT max(STORAGE_USAGE)  FROM TB_PAAS_ZHZY
        WHERE APPLY_NAME=#{appName}
        <include refid="commom"></include>
    </select>

<!--    es内存峰值-->
    <select id="maxEsMemary" resultMap="BaseResultMap">
        SELECT max(ELASTICSEARCH_MEMORY_USED)  FROM TB_PAAS_ZHZY
        WHERE APPLY_NAME=#{appName}
        <include refid="commom"></include>
    </select>

<!--    es  cpu峰值-->
    <select id="maxEsCpu" resultMap="BaseResultMap">
        SELECT max(ELASTICSEARCH_CPU_USAGE)  FROM TB_PAAS_ZHZY
        WHERE APPLY_NAME=#{appName}
        <include refid="commom"></include>
    </select>

    <select id="totalEsMemary" resultMap="BaseResultMap">
    SELECT sum(ELASTICSEARCH_MEMORY_TOTAL) ,sum(ELASTICSEARCH_CPU_TOTAL) ,sum(STORAGE_TOTAL)  FROM TB_PAAS_ZHZY
    WHERE APPLY_NAME=#{appName}
    <include refid="commom"></include>
</select>





<!--    redis  的cpu，内存，使用情况-->
    <select id="getPaasRedisResource" resultMap="BaseResultMap">
        SELECT REDIS_MEMORY_USAGE,ODS_TIME FROM TB_PAAS_ZHZY
        WHERE    APPLY_NAME=#{appName}
        <include refid="commom"></include>

    </select>

<!--    redis内存总量-->
    <select id="totalRedisMemary" resultMap="BaseResultMap">
    SELECT sum(REDIS_MEMORY_TOTAL) FROM TB_PAAS_ZHZY
    WHERE APPLY_NAME=#{appName}
    <include refid="commom"></include>
</select>

<!--    redis内存最高使用率-->
    <select id="maxRedisMemary" resultMap="BaseResultMap">
        SELECT max(REDIS_MEMORY_USAGE) FROM TB_PAAS_ZHZY
        WHERE APPLY_NAME=#{appName}
        <include refid="commom"></include>
    </select>



















































</mapper>
