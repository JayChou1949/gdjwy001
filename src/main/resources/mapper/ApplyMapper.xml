<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.upd.hwcloud.dao.webManage.ApplyMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.upd.hwcloud.bean.entity.webManage.Apply">
        <id column="ID" property="id" />
        <result column="NAME" property="name" />
        <result column="URL" property="url" />
        <result column="IMAGE_ID" property="imageId" />
        <result column="SORT_NUM" property="sortNum" />
        <result column="CONTENT" property="content" />
        <result column="CREATE_TIME" property="createTime" />
        <result column="MODIFIED_TIME" property="modifiedTime" />
        <result column="STATUS" property="status" />
        <result column="CREATOR" property="creator" />
        <result column="SUB_PAGE_URL" property="subPageUrl" />
        <result column="SUB_PAGE_PERMISSION" property="subPagePermission" />
        <result column="HAS_DOC" property="hasDoc" />
        <association property="user" column="CREATOR" select="com.upd.hwcloud.dao.UserMapper.findUserByIdcard" />
    </resultMap>

    <select id="selectList" resultType="com.upd.hwcloud.bean.entity.webManage.Apply">
        SELECT a.ID,a.URL,a.CONTENT,a.NAME,a.SUB_PAGE_URL,a.SUB_PAGE_PERMISSION,a.HAS_DOC,f.URL AS imageUrl FROM TB_APPLY a
        LEFT JOIN TB_FILES f ON a.IMAGE_ID = f.ID
        WHERE a.STATUS = 2
        ORDER BY a.SORT_NUM ASC, a.MODIFIED_TIME DESC
    </select>

    <select id="getPage" resultMap="BaseResultMap">
        SELECT a.*,f.URL AS imageUrl FROM TB_APPLY a
        LEFT JOIN TB_FILES f ON a.IMAGE_ID = f.ID
        WHERE
        <choose>
            <when test="status != null and status == 0">
                a.STATUS IN (0, 3)
            </when>
            <otherwise>
                a.STATUS = #{status}
            </otherwise>
        </choose>
        <if test="name != null and name != ''">
            AND a.NAME LIKE CONCAT(CONCAT('%',#{name}),'%')
        </if>
        <if test="user.type != 100">
            AND CREATOR = #{user.idcard}
        </if>
        ORDER BY a.SORT_NUM ASC, a.MODIFIED_TIME DESC
    </select>

    <select id="selectById" resultMap="BaseResultMap">
        SELECT a.*,f.URL AS imageUrl FROM TB_APPLY a
        LEFT JOIN TB_FILES f ON a.IMAGE_ID = f.ID
        WHERE a.ID = #{id}
    </select>
</mapper>
