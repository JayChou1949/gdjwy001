<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.upd.hwcloud.dao.MonitorMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.upd.hwcloud.bean.entity.Monitor">
        <id column="ID" property="id" />
        <result column="NAME" property="name" />
        <result column="URL" property="url" />
        <result column="STATUS" property="status" />
        <result column="PRODUCER" property="producer" />
        <result column="LAST_REQ_TIME" property="lastReqTime" />
        <result column="LAST_RESPONSE" property="lastResponse" />
        <result column="MODULE" property="module" />
    </resultMap>

    <select id="getPage" resultType="com.upd.hwcloud.bean.entity.Monitor" >
        SELECT M.*, D.NAME AS statusName FROM TB_MONITOR M
        LEFT JOIN SYS_DICT D ON M.STATUS = D.ID
        <where>
            <if test="status != null and status != ''">
                AND M.STATUS = #{status}
            </if>
            <if test="keywords != null and keywords != ''">
                AND (M.NAME LIKE CONCAT(CONCAT('%',#{keywords}),'%')
                OR M.MODULE LIKE CONCAT(CONCAT('%',#{keywords}),'%'))
            </if>
        </where>
        ORDER BY LAST_REQ_TIME DESC
    </select>
</mapper>
